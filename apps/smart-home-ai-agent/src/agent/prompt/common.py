from datetime import datetime, timezone, timedelta

JST = timezone(timedelta(hours=9))


payment_statement_table = """
| 項目 | 2024年10月分 | 2024年11月分 |
|------|--------------|--------------|
| ご請求金額 | 4,926円 | 4,161円 |
| うち消費税等相当額 | 447円 | 378円 |
| 使用期間 | 9月23日～10月22日 | 10月23日～11月22日 |
| 契約種別 | スタンダードS | スタンダードS |
| 契約容量 | 40A | 40A |
| 使用電力量 | 154kWh | 122kWh |
| 基本料金 | 1,247円 | 1,247円 |
| 電力量料金 | 3,244円 | 2,591円 |
| - 1段料金 | 29.80円×120kWh=3,576円 | 29.80円×120kWh=3,576円 |
| - 2段料金 | 36.40円×34kWh=1,237.60円 | 36.40円×2kWh=72.80円 |
| - 燃料費調整額 | -10.19円×154kWh=-1,569.26円 | -8.67円×122kWh=-1,057.74円 |
| 再エネ発電賦課金 | 3.49円×154kWh=537円 | 3.49円×122kWh=425円 |
| ガスセット割 | -102円 | -102円 |
| 託送料金相当額 | 9.44円×154kWh=1,453円 | 9.44円×122kWh=1,151円 |
| うち賠償負担金相当額等 | 0.16円×154kWh=24.64円 | 0.16円×122kWh=19.52円 |
| 燃料費調整単価（翌月分） | -8.67円 | -6.33円 |
| 対前月変化額 | +1.52円 | +2.34円 |
"""


def get_forecast_electric_energy_template():
    now_jst = datetime.now(JST)

    template = f"""
# 指示

以下の業務を行ってください。

1. **{now_jst.year}年{now_jst.month}月分の電力使用量(kWh)および電気料金(円)を予測してください。**  
   - 以下の過去データを参考に、推定根拠（増減の理由）を簡潔に説明してください。
   - 予測値は整合性のある数値を提示してください（実績に対して無理のない範囲での増減）。
   - 基本料金、電力量料金（1段、2段、燃料費調整額、再エネ賦課金、託送料金相当額など）、各種割引等を考慮した上で、最終的な請求金額を示してください。（過去月と同様の計算手順で算出してください）
 
2. **電力量の変化要因として、他のセンサーデータとの相関レポートを簡潔にまとめてください。**  
   - たとえば、気温センサー、日照時間、家電稼働状況センサーなどがあると仮定し、それらが電力消費量に与える影響について説明してください。
   - 関連がある場合、どのような要素が電力量変化に寄与しているかを考察してください。

# 過去実績（参考用）

以下は過去2か月分の実績値です。これらを参考に{now_jst.year}年{now_jst.month}月分を予測してください。

{payment_statement_table}

# 出力形式

1. {now_jst.year}年{now_jst.month}月分の予測結果を下記のような表形式で出力してください（項目は上記過去実績と同様、値は新規計算値を入れてください）。
2. 予測根拠・考察点を箇条書きで示してください。
3. センサーデータ関連の考察を箇条書きで示してください。
"""

    return template
