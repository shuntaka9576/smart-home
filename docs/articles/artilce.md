---
title: "è‡ªå®…ã®æ¶ˆè²»é›»åŠ›ã‚’ç”ŸæˆAIã‚’ä½¿ã£ã¦ç°¡æ˜“ãªåˆ†æã€äºˆæ¸¬ã‚’ã—ã¦ã¿ãŸ"
type: "tech"
category: []
description: ""
published: false
---




## ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã¯ [ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ç™º è£½é€ æ¥­ Advent Calendar 2024](https://adventar.org/calendars/10479) ã®22æ—¥ç›®ã®è¨˜äº‹ã¨ãªã‚Šã¾ã™ã€‚

è£½é€ æ¥­ã¨ã®çµ¡ã¿çš„ã«ã¯ã€é›»åŠ›æ¶ˆè²»ã®å¯è¦–åŒ–ã€åˆ†æã€äºˆæ¸¬ã¯ã‚ˆãã‚ã‚‹ãƒ†ãƒ¼ãƒã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€ã¾ãšèº«è¿‘ãªè‡ªå®…ã‚’ä¾‹ã«è©¦ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

ã¨ã¯ã„ãˆè¨˜äº‹é‡ã®å•é¡Œã§ã€æœ¬è¨˜äº‹ã§ã¯ãƒ‡ãƒ¼ã‚¿åé›†ã‚„ç”ŸæˆAIå‘¨ã‚Šã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã„ãªãŒã‚‰ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸæ§‹ç¯‰ã™ã‚‹ã¨ã“ã‚ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã€åˆ†æã¯ç°¡æ˜“ãªã‚‚ã®ã«ã—ã¦ã„ã¾ã™ã€‚ä»Šå¾Œåˆ†æã€äºˆæƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸè¨˜äº‹ã‚’æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## å‰æ

[AWS IoT ã¨ ç”Ÿæˆ AI ã‚’ä½¿ã£ã¦è‡ªå®…ã®æ¶ˆè²»é›»åŠ›ã‚’æ¸¬å®šãƒ»äºˆæ¸¬ã—ã¦ã¿ã‚ˆã†](https://aws.amazon.com/jp/builders-flash/202411/forecast-house-power-consumption/)ã®è¨˜äº‹ã‚’è¦‹ã¦ç€æƒ³ã‚’ãˆã¾ã—ãŸã€‚æ§‹æˆã‚„åˆ†ææ–¹æ³•ã¯å…¨ãç•°ãªã‚Šã¾ã™ã€‚ã‚ˆã‚Šãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ä½™åœ°ã‚’å¢—ã‚„ã—ã€å®‰å®šã—ã¦å®‰ãæ‰‹è»½ã«é‹ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

:::message
æœ¬è¨˜äº‹ã‚’èª­ã‚€ä¸Šã§ä»¥ä¸‹ã®æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ã”ç†è§£é ‚ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚ğŸ™‡

* æ—¥æ›œå¤§å·¥çš„ãªå†…å®¹ãªã®ã§ãƒ‡ãƒ¼ã‚¿é‡ã¯å¤šããªãã€å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿åˆ†æã§ã¯ã‚ã‚Šã¾ã›ã‚“
* åˆå›ã®è¨˜äº‹ãªã®ã§ç”ŸæˆAIã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã†ã¨ã“ã‚ãŒãƒ¡ã‚¤ãƒ³ã§ã™ã€‚åˆ†æã‚„äºˆæ¸¬ã¯ãŠã¾ã‘ç¨‹åº¦ã§ã™ (ä»Šå¾Œãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã—ãŸã„)
* å‘½åè¦å‰‡ã®é–¢ä¿‚ä¸Šã€ç”ŸæˆAIã‚¢ãƒ—ãƒªéƒ¨åˆ†ã‚’AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨å‘¼ç§°ã—ã¦ã„ã¾ã™ãŒã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãªã‚‹éç¨‹ã§ã™ã€‚å˜ã«ç”ŸæˆAIã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã¨èª­ã¿æ›¿ãˆã¦ãã ã•ã„

æƒ³å®šèª­è€…ã¨ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™

* è‡ªå®…ã®é›»åŠ›ãƒ‡ãƒ¼ã‚¿ã‚„ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ãŸã„
* ç”ŸæˆAIã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ (LangGraph,MCP,LangChain,Bedrock)ã‚’ä½¿ã£ãŸåˆ†æã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãŸã„
:::

æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€å…¨ã¦ã“ã¡ã‚‰ã«ç½®ã„ã¦ã„ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ã‚¤ãƒ³ãƒ•ãƒ©å…¨ã¦ç”¨æ„ã—ã¦ã„ã‚‹ã®ã§ã€å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

https://github.com/shuntaka9576/smart-home

## ç”ŸæˆAIã‚’ä½¿ã£ã¦è©¦ã™å†…å®¹

### æ¦‚è¦

ä»¥ä¸‹2ã¤ã‚’è©¦ã—ã¾ã™ã€‚

* é›»æ°—æ–™é‡‘ã®äºˆæ¸¬
* é›»åŠ›é‡ã¨ãã®ä»–æŒ‡æ¨™ã®é–¢é€£åˆ†æ

### æ‰‹æ³•

ã©ã®ã‚ˆã†ãªã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«å¯¾ã—ã¦ã€ã©ã®ã‚ˆã†ãªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãŒè¿”å´ã•ã‚Œã‚‹ã®ã‹ã‚’ç¢ºèªã—ã€ã‚ãã¾ã§ç”ŸæˆAIã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½“é¨“ã§ãã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚ç²¾åº¦ã®æ¯”è¼ƒã¯åˆ¥è¨˜äº‹ã§è¡Œã„ãŸã„ã¨æ€ã„ã¾ã™ã€‚

* æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹
* æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç”»åƒã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹

ã¾ãŸæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã¯MCPã§å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã§ã€Claude Desktopã‚’ä½¿ã£ãŸåˆ†æã‚‚è¡Œã„ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹

|é …|å†…å®¹|æœŸé–“|
|---|---|---|
|1.|éå»ã®é›»æ°—æ–™é‡‘|2ãƒ¶æœˆåˆ†|
|2.|ç©ç®—é›»åŠ›é‡,15åˆ†ã”ã¨ã®æ°—æ¸©,æ¹¿åº¦,ç…§åº¦,ã‚¨ã‚¢ã‚³ãƒ³ã®èµ·å‹•çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿|12æœˆ14æ—¥ã‹ã‚‰è¨ˆæ¸¬é–‹å§‹|

ä»¥é™ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨å‘¼ç§°ã—ã¾ã™ã€‚

## æ§‹æˆ

### å¿…è¦ãªã‚‚ã®

|å•†å“å|ç”¨é€”|
|---|---|
|[Nature Remo 3](https://amzn.asia/d/foS70lU)|æ°—æ¸©,æ¹¿åº¦,ç…§åº¦,ã‚¨ã‚¢ã‚³ãƒ³ã®èµ·å‹•çŠ¶æ…‹ã®èµ·å‹•çŠ¶æ…‹ã®å–å¾—
|[Nature Remo E lite](https://amzn.asia/d/aSmi49w)|é›»åŠ›é‡ã®å–å¾— â€» Bãƒ«ãƒ¼ãƒˆç”³è«‹ãŒå¿…è¦(å¾Œè¿°)

### å…¨ä½“åƒ

å…¨ä½“åƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ä»¥ä¸‹ã®é †ã§æ§‹æˆå›³ã®è§£èª¬ã‚’ã—ã¾ã™ã€‚

* ãƒ‡ãƒ¼ã‚¿åé›†
* ãƒ‡ãƒ¼ã‚¿é…ä¿¡
* ç”ŸæˆAI(Claude Desktop with MCP)ã«ã‚ˆã‚‹åˆ†æ
* ç”ŸæˆAI(LangGraph)ã«ã‚ˆã‚‹åˆ†æ

![architecture](https://devio2024-media.developers.io/image/upload/v1734727155/2024/12/21/n85ip5c2o1vqnavc9yvc.png)

### ãƒ‡ãƒ¼ã‚¿åé›†

ã¾ãšã¯ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿(é›»åŠ›é‡,æ°—æ¸©,æ¹¿åº¦,ç…§åº¦,ã‚¨ã‚¢ã‚³ãƒ³ã®èµ·å‹•çŠ¶æ…‹)ã‚’ãƒ‡ãƒ¼ã‚¿åŸºç›¤(åé›†)ã§è²¯ã‚ã¾ã™ã€‚ä»Šå›ä½¿ç”¨ã—ã¦ã„ã‚‹Natureã®æ©Ÿå™¨ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ã€Natureã®ã‚¯ãƒ©ã‚¦ãƒ‰APIã§å–å¾—ã§ãã¾ã™ã€‚
![architecture_01](https://devio2024-media.developers.io/image/upload/v1734727141/2024/12/21/fnwcegqtqoox6hf6wgg5.png)

1. `[1]EventBridge` (15åˆ†ã«1å›)ã§ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
2. `[2]Lambda(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿)` ã‚’èµ·å‹•ã—ã€`[3]Natureã®ã‚¯ãƒ©ã‚¦ãƒ‰API`ã‚’å®Ÿè¡Œã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€`[4]Supabase`ã¸æ›¸ãè¾¼ã¿

### ãƒ‡ãƒ¼ã‚¿é…ä¿¡

ä»Šå›ã¯ `AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ—ãƒª` ã‹ã‚‰ã‚‚ `Claude Desktop` ã‹ã‚‰é›»åŠ›é‡ã€ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯MCPçµŒç”±ã§å–å¾—ã™ã‚‹äºˆå®šã®ãŸã‚ã€HTTP APIã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã“ã®HTTP APIã¯Goã®MCPã‚µãƒ¼ãƒãƒ¼ã§ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚

![architecture_02](https://devio2024-media.developers.io/image/upload/v1734727145/2024/12/21/pd0svdremzy2yzavi6ho.png)

1. `[1]APIGateway`ãŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹(æœŸé–“æŒ‡å®šsince=yyyy-MM-dd HH:mm&until=yyyy-MM-dd HH:mm)
2. `[2]Lambda(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)`ãŒæœŸé–“ã«å¿œã˜ãŸã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ¼ã‚’`[3]Supabase`ã«è¦æ±‚ã—å—ã‘å–ã‚‹
4. `[2]Lambda`ã‹ã‚‰`[1]APIGateway` ã«è¿”å´ã—ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚„Claude Desktopã¸ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´

### ç”ŸæˆAI(Claude Desktop with MCP)ã«ã‚ˆã‚‹åˆ†æ

![architecture_03](https://devio2024-media.developers.io/image/upload/v1734727149/2024/12/21/drgo3eqzjjy6dbievcke.png)

1. `[2]Claude Desktop` ã®ã‚³ãƒ³ãƒ•ã‚£ã‚° `[3]MCPã‚µãƒ¼ãƒãƒ¼` ã®è¨­å®š
2. `[1]ç§` ãŒ `[2]Claude Desktop` ã‚’ä½¿ã„ `[3]MCPã‚µãƒ¼ãƒãƒ¼` ã‚’çµŒç”±ã—ã€`[4]APIGateway(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)` ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
3. `[2]Claude Desktop` ã¯é …2ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã€`[1]ç§` ã¸è¿”å´

### ç”ŸæˆAI(LangGraph)ã«ã‚ˆã‚‹åˆ†æ

![architecture_04](https://devio2024-media.developers.io/image/upload/v1734736756/2024/12/21/zpmuylxuun1z9b0dd4te.png)

1. `[1]IFTTT` ã¯å¤–å‡ºã‚’æ¤œçŸ¥ã—ã€`[2]Lambda(AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)` ã¸ `Webhook(HTTPS POST)` ã§æ©Ÿèƒ½å®Ÿè¡Œã‚’è¦æ±‚
2. `[2]Lambda(AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)` ã¯ã€èµ·å‹•ã—ãŸLangGraphã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å…ƒã« `[4]MCPã‚µãƒ¼ãƒãƒ¼` ã¸ `JSON RPC 2.0 on æ¨™æº–å…¥åŠ›` ã§ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
3. `[4]MCPã‚µãƒ¼ãƒãƒ¼` ã¯ã€`[5]APIGateway(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)` ã¸ `HTTPS` ã§ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
4. `[5]APIGateway(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)` ã¯ã€ `[5]Lambda(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)` ã¸ `AWSå†…éƒ¨é€šä¿¡` ã§ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
5. `[5]Lambda(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡)` ã¸ `[6]Supabase(ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜)` ã¸ ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
6. é …5ã®é€šä¿¡ã®æˆ»ã‚Š
7. é …4ã®é€šä¿¡ã®æˆ»ã‚Š
8. é …3ã®é€šä¿¡ã®æˆ»ã‚Š
9. é …2ã®é€šä¿¡ã®æˆ»ã‚Š
10. `[2]Lambda(AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)` ã¯å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«Bedrockã‚’ä½¿ã„ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã€`[8]Slack` ã¸ `Webhook(HTTPS POST)` ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’`[9]ç§`ã«é€ä¿¡

é …1ã®IFTTTã¯ã‚ãã¾ã§ä¾‹ãªã®ã§å®Ÿè£…ã¯ãªã„ã§ã™ã€‚ä½•ã‚‰ã‹ã®ç™ºç«ã™ã‚‹æ¦‚å¿µãŒå¿…è¦ã§ã™ã€‚IFTTTã ã¨å¤–å‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç™ºç«ã§ãä»Šå›ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨åˆã£ã¦ã„ã‚‹ã‹ãªã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

Webhookã‚’ã‚»ã‚­ãƒ¥ã‚¢ã«é‹ç”¨ã™ã‚‹å ´åˆã€ãƒœãƒ‡ã‚£éƒ¨ã‚’äºˆæƒ³ã•ã‚Œã«ãã„æ–‡å­—åˆ—ã§SHA256ãƒãƒƒã‚·ãƒ¥ã‚’ã¤ã‘ã¦HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¤ã‘ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚æœ¬è¨˜äº‹ã§ã¯ç´¹ä»‹ã—ã¾ã›ã‚“ã€‚

## ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å‰æº–å‚™

### Bãƒ«ãƒ¼ãƒˆç”³è«‹

Bãƒ«ãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ãƒ¼ã§è¨ˆæ¸¬ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’HEMS(ãƒ˜ãƒ ã‚¹)æ©Ÿå™¨ã¸é€ä¿¡ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ä»¥ä¸‹ã®URLã‹ã‚‰ç”³ã—è¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚

https://www.tepco.co.jp/pg/consignment/liberalization/smartmeter-broute.html

1. Webã§ç”³è«‹
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒ¡ãƒ¼ãƒ«ã«ã¦é€ä»˜ã•ã‚Œã€èªè¨¼IDãŒéƒµé€ã•ã‚Œã‚‹

Webã§ã®ç”³è«‹ã®æ³¨æ„ç‚¹é…ä¸‹ã§ã™ã€‚
* ä¾›çµ¦åœ°ç‚¹ç•ªå·ã‚’ç”¨æ„ã™ã‚‹
* ä½æ‰€ã«å¥‘ç´„ã—ã¦ã„ã‚‹é›»åŠ›ä¼šç¤¾ã®è¨—é€ä¸Šã®ä½æ‰€ã§æ›¸ãå¿…è¦ãŒã‚ã‚Š(ç§ã¯å»ºç‰©åã‚’æŠœã‹ã—ã¦ã—ã¾ã„ã€1åº¦ç…§åˆçµæœç›¸é•ã§å†ç”³ã—è¾¼ã¿ã¨ãªã‚Šã¾ã—ãŸ)

ç§ã¯æ±äº¬é›»åŠ›ã§å¥‘ç´„ã—ã¦ã„ã‚‹ã®TEPCO Webã‹ã‚‰ä¸¡æ–¹ã®æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ãã¾ã—ãŸã€‚

æ±äº¬åœ¨ä½ã§12/3(ç«)ã«ç”³ã—è¾¼ã¿12/5(æœ¨)ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€12/9(æœˆ)ã«ã¯èªè¨¼IDãŒéƒµé€ã•ã‚Œã¾ã—ãŸã€‚å‚è€ƒã¾ã§ã«ã€‚

èªè¨¼IDã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§å°æ›¸ãŒå±Šãã€ç¢ºèªã§ãã¾ã™ã€‚

![1](https://devio2024-media.developers.io/image/upload/v1733959846/2024/12/12/fy6zalbu1pssxrzbdmdp.jpg)
![2](https://devio2024-media.developers.io/image/upload/v1733960014/2024/12/12/amlebgokmo7ficzbz7aa.jpg)

### HEMSæ©Ÿå™¨ã®æº–å‚™

AWSã®è¨˜äº‹ã§ã¯[Wi-SUN USBã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ RS-WSUHAã‚·ãƒªãƒ¼ã‚º](https://www.ratocsystems.com/products/wisun/usb-wisun/rs-wsuha/)ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€[Nature Remo E lite](https://shop.nature.global/products/nature-remo-e-lite?srsltid=AfmBOophBk-D0lMmFneXFuJcOTBBWrcNufVktIVmOucfBRx72DythdPu)ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚ãƒ©ã‚ºãƒ‘ã‚¤ã¯çŸ­æœŸã®æ¤œè¨¼ã§ã¯è‰¯ã„ã§ã™ãŒã€é‹ç”¨é¢ã‚„æ–™é‡‘é¢(AWS IoT)ã‚’è€ƒæ…®ã—ãŸçµæœã§ã™ã€‚ã“ã“ã‚‰è¾ºã¯å¥½ã¿ã§ã™ã®ã§ã€ã‚¨ãƒƒã‚¸IoTã‚’ä½“æ„Ÿã—ãŸã„äººã¯å†’é ­ã®AWSã®è¨˜äº‹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

### Nature Remo E liteã®è¨­å®š

å¤–ç®±ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ï¼
![IMG_3324](https://devio2024-media.developers.io/image/upload/v1733960432/2024/12/12/hkesrwv3yfvkusyfpxp4.jpg)

ä¸­èº«ã¯æ€ã£ãŸã‚ˆã‚Šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã¨æ„Ÿã˜ã¾ã—ãŸï¼
![IMG_3325](https://devio2024-media.developers.io/image/upload/v1733960427/2024/12/12/gktcgvfajga5midygpij.jpg)

ä»˜å±ã—ã¦ã„ã‚‹ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã‚’å…ƒã«Nature Homeã‚¢ãƒ—ãƒªã‚’ä½¿ã£ã¦æ‰‹é †ã‚’è¡Œãªã£ã¦ã„ãã¾ã™ã€‚

ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ç”»åƒã®ã‚ˆã†ã«ã‚³ãƒ³ã‚»ãƒ³ãƒˆã«ç¹‹ãã“ã¨ã§ã€ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ãã¾ã™ã€‚
![IMG_3330 (2)](https://devio2024-media.developers.io/image/upload/v1733962689/2024/12/12/ok6qg2kvvua6ybxf3jmz.jpg)

ã‚¢ãƒ—ãƒªå´ã®è¨­å®šã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

:::details ã‚¢ãƒ—ãƒªã®è¨­å®š

|èª¬æ˜|ç”»åƒ|
|---|---|
|ã‚¢ãƒ—ãƒªã®æŒ‡ç¤ºã«å¾“ã£ã¦é€£æºä½œæ¥­ã‚’ã—ã¾ã™ã€‚WiFiè¨­å®šå¾Œãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãŒå…¥ã‚‹ã®ã§ã€æ•°åˆ†æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚æ‰‹é †é€šã‚Šã‚„ã‚‹ã¨ã‚¢ãƒ—ãƒªã«Nature Remo E liteãŒè¿½åŠ ã§ãã¾ã™ã€‚|![IMG_3334](https://devio2024-media.developers.io/image/upload/v1733963759/2024/12/12/iwohlcffsdtt024bqbam.png)|
|èµ¤æ ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™|![IMG_3335ï¼¿ï¼’](https://devio2024-media.developers.io/image/upload/v1733963678/2024/12/12/wqruh9kmdneelv5pwzfr.png)|
|ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ã¨ã®æ¥ç¶šãŒæ¡ˆå†…ã•ã‚Œã¾ã™|![IMG_3336](https://devio2024-media.developers.io/image/upload/v1733963873/2024/12/12/nksgiqy37chredeirjbo.png)
|ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã—ã¾ã™|![IMG_3337](https://devio2024-media.developers.io/image/upload/v1733963915/2024/12/12/dh6pzmp634k420kgzecm.png)|
|Bãƒ«ãƒ¼ãƒˆç”³è«‹ã®èªè¨¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™|![IMG_3338](https://devio2024-media.developers.io/image/upload/v1733963979/2024/12/12/cnwkovlojqvxezf4fcfv.png)
|æ¤œç´¢->é€šä¿¡ã‚’çµŒã¦æ•°åˆ†ã§æ¥ç¶šãŒå®Œäº†ã—ã¾ã™|![IMG_3341](https://devio2024-media.developers.io/image/upload/v1733964618/2024/12/12/rlucdrtns8e61wcvn1x5.png)
|ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ã¨é€£æºãŒå®Œäº†ã—ã¾ã™|![IMG_3343](https://devio2024-media.developers.io/image/upload/v1733964636/2024/12/12/p8ud9meyxxjjlkgsa3qc.png)
|Remo E liteãŒã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¿ãƒ–ã®ç”»é¢ä¸Šéƒ¨ã¨ä¸­éƒ¨ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼|![IMG_3344](https://devio2024-media.developers.io/image/upload/v1733964648/2024/12/12/amschhdf4kk1afdjweiv.png)
|å‰é …ã®ç”»é¢ä¸­éƒ¨ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸãŒã€ã¾ã é€£æºç›´å¾Œãªã®ã§è¡¨ç¤ºã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ|![IMG_3345](https://devio2024-media.developers.io/image/upload/v1733964655/2024/12/12/vzlegnfgwg0dtdhb9zbc.png)
|å°‘ã—ã—ãŸã‚‰ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã¾ã—ãŸï¼|![IMG_C0256F26C692-1 2](https://devio2024-media.developers.io/image/upload/v1733966032/2024/12/12/kw4yuqbqgrmbfbtywkj5.jpg)

:::

## ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿åé›†å®Ÿè£…

### æ§‹æˆå›³

èµ¤æ ã®å®Ÿè£…ã‚’ã—ã¦ã„ãã¾ã™ã€‚

![architecture_01](https://devio2024-media.developers.io/image/upload/v1734727141/2024/12/21/fnwcegqtqoox6hf6wgg5.png)

### å®Ÿè£…

å®Ÿè£…ã®å…¨ä½“æ„Ÿã¯[github.com/shuntaka9576/smart-home](https://github.com/shuntaka9576/smart-home/tree/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

#### Supabaseã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ

ã¾ãšãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¨­è¨ˆã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿å‹ã¯Floatã«ã—ã¾ã—ãŸãŒã€ æµ®å‹•å°æ•°ç‚¹èª¤å·®ã‚’è€ƒæ…®ã™ã‚‹ã¨DecimalãŒæ¨å¥¨ã§ã™ã€‚(è¨˜äº‹ã‚’å…¬é–‹ã—ãŸã‚‰ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚ã€‚)

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å                     | ãƒ‡ãƒ¼ã‚¿å‹   | PK | FK | å¿…é ˆ | ãã®ä»–åˆ¶ç´„ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | åˆ—æŒ™å€¤ | èª¬æ˜ |
|----------------------------------|------------|----|----|------|------------|------------|--------|------|
| id                               | String     | â—¯  |    | â—¯    | -          | -          | -      |UUID|
| cumulative_electric_energy       | Float      |    |    | â—¯    | -          | -          | -      |ç©ç®—é›»åŠ›é‡è¨ˆæ¸¬å€¤(kWh)|
| measured_instantaneous           | Float      |    |    | â—¯    | -          | -          | -      |ç¬æ™‚é›»åŠ›è¨ˆæ¸¬å€¤(w)|
| temperature                      | Float      |    |    | â—¯    | -          | -          | -      |æ°—æ¸©|
| humidity                         | Float      |    |    | â—¯    | -          | -          | -      |æ¹¿åº¦|
| illuminance                      | Float      |    |    | â—¯    | -          | -          | -      |ç…§åº¦|
| ac_status                        | Boolean    |    |    | â—¯    | -          | -          | -      |ã‚¨ã‚¢ã‚³ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹|
| created_at                       | DateTime   |    |    | â—¯    | -          | ç¾åœ¨æ™‚åˆ»   | -      |ä½œæˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(â€»1)|
| updated_at                       | DateTime   |    |    | â—¯    | -          | ç¾åœ¨æ™‚åˆ»   | -      |ä½œæˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(â€»1)|

â€»1

ã“ã®å®šç¾©é€šã‚Šã€Prismaã®ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform/prisma/schema.prisma#L1-L23

Supabaseä¸Šã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ã€DBã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚æ¥ç¶šæƒ…å ±ã‚’å…ƒã«ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã‹ã‚‰æ¥ç¶šã€‚ä»¥ä¸‹ã®æ¥ç¶šå…ˆãŒã‚ã‚Š `Session pooler` ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã†ã€‚

* Direct connection
* Transaction pooler
* Session pooler <- ã‚’ä½¿ã†

ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å…¥ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã€‚ä»Šå›ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `postgres` ã‚’ä½¿ã†ã“ã¨ã¨ã™ã‚‹ã€‚
```bash
psql "postgresql://postgres.<endpoint>:<password>J@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres"
```
smart-home-data-platformã®`.env` ã« `DATABASE_URL` ã‚’è¨­å®šã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash:.env
DATABASE_URL="postgresql://postgres.<endpoint>:<password>@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres"
```

```bash:ã‚¹ã‚­ãƒ¼ãƒã®ãƒ‡ãƒ—ãƒ­ã‚¤
cd apps/smart-home-data-platform

pnpm prisma generate
pnpm prisma migrate dev --name init
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

ã‚¢ãƒ—ãƒªã®å®Ÿè£…ã§ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ã®ã¯åŸºæœ¬çš„ã«ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ã§ã™ã€‚ä»Šå›ä½¿ã†Natureã®ã‚°ãƒ­ãƒ¼ãƒãƒ«APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ä»¥ä¸‹ã®2ã¤ã§ã™ã€‚

|ãƒ‘ã‚¹|ç”¨é€”|
|---|---|
|`/1/appliances`|é›»åŠ›é‡, ç©ºèª¿èµ·å‹•çŠ¶æ…‹|
|`/1/devices`|æ°—æ¸©,æ¹¿åº¦,ç…§åº¦|

ãã‚Œãã‚ŒAPIã‚’ç”Ÿã§å©ã„ã¦ã¿ã¾ã™ã€‚

```bash
export NATURE_API_TOKEN="<APIãƒˆãƒ¼ã‚¯ãƒ³>"
```

é›»åŠ›é‡ã€ç©ºèª¿èµ·å‹•çŠ¶æ…‹ãŒå–ã‚Œã‚‹APIã‚’å©ã„ã¦ã¿ã¾ã™ã€‚
```bash:ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(/1/appliances)
curl -X GET "https://api.nature.global/1/appliances" -k --header "Authorization: Bearer $NATURE_API_TOKEN" | jq
```

ã‚³ãƒ¡ãƒ³ãƒˆã«ã¦ã€åˆ©ç”¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
```json:ãƒ¬ã‚¹ãƒãƒ³ã‚¹(/1/appliances) â€» ä¸€éƒ¨
[
  {
    "device": {
      "name": "Remo",
      ...
    },
    ...
    "type": "AC",
    "nickname": "ã‚¨ã‚¢ã‚³ãƒ³",
    "image": "ico_ac_1",
    "settings": {
      "temp": "23",
      "temp_unit": "c",
      "mode": "warm",
      "vol": "2",
      "dir": "1",
      "dirh": "still",
      "button": "", //  <-- ç¾åœ¨ã‚¨ã‚¢ã‚³ãƒ³ã®ãƒªãƒ¢ã‚³ãƒ³ã‚’è¡¨ã™ãŸã‚ã€èµ·å‹•çŠ¶æ…‹ã‚’åˆ¤å®šå¯èƒ½
      "updated_at": "2024-12-21T00:30:06Z"
    },
    ....
  },
  {
    "device": {
      "name": "Remo E lite",
      ...
    },
    ...
    "type": "EL_SMART_METER",
    "nickname": "ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ãƒ¼",
    "image": "ico_smartmeter",
    "settings": null,
    "aircon": null,
    "signals": [],
    "smart_meter": {
      "echonetlite_properties": [ // <-- ã“ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é›»åŠ›é‡ç®—å‡ºã«åˆ©ç”¨
        {
          "name": "coefficient",
          "epc": 211,
          "val": "1",
          "updated_at": "2024-12-21T08:25:42Z"
        },
        {
          "name": "cumulative_electric_energy_effective_digits",
          "epc": 215,
          "val": "6",
          "updated_at": "2024-12-21T08:25:42Z"
        },
        {
          "name": "normal_direction_cumulative_electric_energy",
          "epc": 224,
          "val": "91954",
          "updated_at": "2024-12-21T08:25:42Z"
        },
        {
          "name": "cumulative_electric_energy_unit",
          "epc": 225,
          "val": "1",
          "updated_at": "2024-12-21T08:25:42Z"
        },
        {
          "name": "reverse_direction_cumulative_electric_energy",
          "epc": 227,
          "val": "13",
          "updated_at": "2024-12-21T08:25:42Z"
        },
        {
          "name": "measured_instantaneous",
          "epc": 231,
          "val": "350",
          "updated_at": "2024-12-21T08:25:43Z"
        }
      ]
    }
  }
]

```

ãã®ä»–æ°—æ¸©ã€æ¹¿åº¦ã€ç…§åº¦ã¯ã“ã¡ã‚‰ã§ã™ã€‚
```bash:ãƒªã‚¯ã‚¨ã‚¹ãƒˆ(/1/devices)
curl -X GET "https://api.nature.global/1/appliances" -k --header "Authorization: Bearer $NATURE_API_TOKEN" | jq
```

```json:ãƒ¬ã‚¹ãƒãƒ³ã‚¹(/1/devices) â€» ä¸€éƒ¨
[
  {
    "name": "Remo",
    ...
    ],
    "newest_events": {
      "hu": {  // æ¹¿åº¦
        "val": 55,
        "created_at": "2024-12-21T08:27:13Z"
      },
      "il": { // ç…§åº¦
        "val": 46,
        "created_at": "2024-12-21T08:25:07Z"
      },
      "mo": { // äººæ„Ÿ
        "val": 1,
        "created_at": "2024-12-21T08:24:59Z"
      },
      "te": { // æ°—æ¸©
        "val": 25,
        "created_at": "2024-12-21T08:30:14Z"
      }
    },
    "online": true
  },
  {
    "name": "Remo E lite",
    ...
  }
]
```

åŸºæœ¬çš„ã«é›»åŠ›é‡(cumulative_electric_energy)ä»¥å¤–ã¯ã€å–å¾—ã—ãŸã‚‚ã®ã‚’ãã®ã¾ã¾ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿ã¾ã™ã€‚15åˆ†ã«1åº¦EventBridgeçµŒç”±ã§å®Ÿè¡Œã—ã€æ›¸ãè¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚ãã‚Œãã‚Œã®å€¤ã«å¯¾ã—ã¦æ›¸ãè¾¼ã¿æ™‚é–“ãŒã¤ã„ã¦ã„ã‚‹ã®ã§ã€å³å¯†ã«ã‚„ã‚‹å ´åˆã¯ã“ã®å€¤ã‚‚è€ƒæ…®ã—ãŸæ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯ã»ã¼ãƒ‹ã‚¢ãƒªã‚¢ãƒ«ã«æ›´æ–°ã•ã‚Œã‚‹ã¨ã„ã†å‰æã§ã€15åˆ†ã”ã¨ã«æ›¸ãè¾¼ã‚“ã§ã„ã¾ã™ã€‚

æ›¸ãè¾¼ã¿å‡¦ç†ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform/src/application/use-cases/store-home-condition-use-case.ts#L1-L19

é›»åŠ›é‡ã«é–¢ã—ã¦ã¯ã€`/1/appliances` Natureã®APIã¯ã€ECHONET Liteã®ä»•æ§˜ã§ä¸€éƒ¨å€¤ã‚’è¿”å´ã—ã¾ã™ã€‚Natureã•ã‚“ã®[é›»åŠ›ãƒ‡ãƒ¼ã‚¿ç®—å‡ºæ–¹æ³•](https://developer.nature.global/docs/how-to-calculate-energy-data-from-smart-meter-values/)ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒéå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

[ã‚¹ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ã‚¿ãƒ¼ã®å„EPCã®è§£èª¬](https://developer.nature.global/docs/how-to-calculate-energy-data-from-smart-meter-values/#%E3%82%B9%E3%83%9E%E3%83%BC%E3%83%88%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E5%90%84epc%E3%81%AE%E8%A7%A3%E8%AA%AC)ã‚’ã‚ˆã‚Šã€ç©ç®—é›»åŠ›é‡è¨ˆæ¸¬å€¤(æ­£æ–¹å‘) `normal_direction_cumulative_electric_energy` ã¨ ç©ç®—é›»åŠ›é‡å˜ä½ `cumulative_electric_energy_unit` ã§ä¹—ç®—ã™ã‚‹ã“ã¨ã§é›»åŠ›é‡(kWh)ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚å®Ÿæ•°éƒ¨ã¨å˜ä½ã‚’åˆ†ã‘ã¦ã„ã‚‹ã®ã¯æµ®å‹•å°æ•°ç‚¹èª¤å·®ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆã«ã‚ˆã‚‹ã‚‚ã®ã ã¨æ¨æ¸¬ã—ã¾ã™ã€‚

ç©ç®—é›»åŠ›é‡å˜ä½ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å®Ÿè£…
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform/src/domain/service/smart-meter-echonet-calculator.ts#L44-L69

ç©ç®—é›»åŠ›é‡(æ­£æ–¹å‘)ã¨ç©ç®—é›»åŠ›é‡å˜ä½ã‚’ä¹—ç®—ã—ã¦ã„ã¾ã™ã€‚JavaScriptã®è¨ˆç®—èª¤å·®ã‚’é˜²ããŸã‚ã«decimal.jsã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚(ç¹°ã‚Šè¿”ã—ã«ã¯ãªã‚Šã¾ã™ãŒã€DBã‚’Decimalå‹ã«ã—ã¦Prisma.Decimalã‚’ä½¿ã†ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚)
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform/src/domain/service/smart-meter-echonet-calculator.ts#L15-L23

#### IaC

ä»Šå›ã¯Lambdaã‹ã‚‰æ›¸ãè¾¼ã‚€ã®ã§ã€Prismaã®å ´åˆã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒã‚¤ãƒŠãƒªã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€å°‘ã—é¢å€’ã§ã—ãŸã€‚[drizzle-orm](https://github.com/drizzle-team/drizzle-orm)ã‚„[kysely](https://github.com/kysely-org/kysely)ãªã‚“ã‹ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/iac/lib/smart-home-data-platform-resource.ts#L23-L35

Lambdaã®ARM_64ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã§æŒ‡å®šãŒå¿…è¦ã§ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-data-platform/prisma/schema.prisma#L3

### ç¢ºèª

Supabaseã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Šè¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![CleanShot 2024-12-21 at 17.44.27@2x](https://devio2024-media.developers.io/image/upload/v1734770711/2024/12/21/m12nec3cy5val0mih3z1.png)

## ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿é…ä¿¡å®Ÿè£…

### æ§‹æˆå›³

APIGatewayã¨Lambdaã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ§‹æˆã§ã™ã€‚APIGatewayã‚’ä½¿ã£ãŸã®ã¯ã€APIã‚­ãƒ¼ã§ã®èªè¨¼ãŒæ‰‹è»½ã«ã§ãã‚‹ãŸã‚ã§ã™ã€‚

![architecture_02](https://devio2024-media.developers.io/image/upload/v1734727145/2024/12/21/pd0svdremzy2yzavi6ho.png)

### å®Ÿè£…

å®Ÿè£…ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¯[ã“ã¡ã‚‰](https://github.com/shuntaka9576/smart-home/blob/daa4b240adef672f46447ceecc15a1409bbbae9c/apps/smart-home-data-platform/src/interfaces/lambda/api-gatway/rest-api-handler.ts)ã§ã™ã€‚

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

`yyyy-MM-dd HH:mm`ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«sinceã¨untilã‚’æŒ‡å®šã—ã¦ã€ãã®æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å…¥ã£ã¦ã„ã‚‹ã®ã¯`ç©ç®—é›»åŠ›é‡(æ­£æ–¹å‘)`ãªã®ã§ã€ã“ã‚Œã¯ã»ã¼ãšã£ã¨ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ã€‚æ•…ã«ã‚ã‚‹æ™‚ç‚¹ã¨ã‚ã‚‹æ™‚ç‚¹ã®å·®ãŒåˆ©ç”¨ã—ãŸé›»åŠ›é‡ã¨ãªã‚Šã¾ã™ã€‚

ç²¾åº¦ã¯ã–ã£ãã‚Šã«ã¯ãªã‚Šã¾ã™ãŒã€15åˆ†ã”ã¨ã®åˆ©ç”¨æ–™ã‚’é…åˆ—ã«è©°ã‚ã¦è¿”å´ã—ã¦ã„ã¾ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/daa4b240adef672f46447ceecc15a1409bbbae9c/apps/smart-home-data-platform/src/domain/service/smart-meter-echonet-calculator.ts#L78-L87

ä»Šå¾ŒNåˆ†è¶³ã€Næ™‚é–“è¶³ã€æ—¥è¶³ã¨ã„ã†æ„Ÿã˜ã§å‹•çš„ã«è¨ˆç®—ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã§ã™ã­ã€‚

#### IaC

ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿åé›†å®Ÿè£…åŒæ§˜ã®Primaã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šãŒå¿…è¦ã§ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/daa4b240adef672f46447ceecc15a1409bbbae9c/iac/lib/smart-home-data-platform-resource.ts#L73-L123

### ç¢ºèª

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸAPIGatewayã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash:APIGatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨APIã‚­ãƒ¼ã‚’ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦è¨­å®šã™ã‚‹
export SMART_HOME_API_GATEWAY_DOMAIN="" # https://xxxxxxxxxx.execute-api.ap-northeast-1.amazonaws.com/v1 ã¾ã§å«ã‚ã‚‹
export SMART_HOME_API_KEY=""
```

```bash:ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
curl -X GET \
  -H "Accept: application/json" \
  -H "x-api-key: $SMART_HOME_API_KEY" \
  "$SMART_HOME_API_GATEWAY_DOMAIN/home-condition?since=2024-12-19%2000:00&until=2024-12-19%2001:00"
```

```json:çµæœ
{
  "homeConditions": [
    {
      "id": "3caaa05a-92ed-4ba3-955c-b0215750201c",
      "cumulativeElectricEnergy": 9180.2,
      "measuredInstantaneous": 94,
      "temperature": 16,
      "humidity": 80,
      "illuminance": 0,
      "acStatus": false,
      "createdAt": "2024-12-19T00:00:35.849+09:00",
      "updatedAt": "2024-12-19T00:00:35.849+09:00",
      "electricEnergyDelta": 23.9
    },
    {
      "id": "199e2ffd-466c-4f6d-a770-00a5c1d6c710",
      "cumulativeElectricEnergy": 9180.2,
      "measuredInstantaneous": 84,
      "temperature": 16,
      "humidity": 80,
      "illuminance": 0,
      "acStatus": false,
      "createdAt": "2024-12-19T00:15:36.332+09:00",
      "updatedAt": "2024-12-19T00:15:36.332+09:00",
      "electricEnergyDelta": 0
    },
    {
      "id": "52925c69-6dd6-407e-8689-ef65cffb8c01",
      "cumulativeElectricEnergy": 9180.3,
      "measuredInstantaneous": 51,
      "temperature": 15.8,
      "humidity": 80,
      "illuminance": 0,
      "acStatus": false,
      "createdAt": "2024-12-19T00:30:36.170+09:00",
      "updatedAt": "2024-12-19T00:30:36.170+09:00",
      "electricEnergyDelta": 0.1
    },
    {
      "id": "0a9fd4f0-54d8-4098-9b36-300aebd4c769",
      "cumulativeElectricEnergy": 9180.3,
      "measuredInstantaneous": 69,
      "temperature": 15.7,
      "humidity": 80,
      "illuminance": 0,
      "acStatus": false,
      "createdAt": "2024-12-19T00:45:35.800+09:00",
      "updatedAt": "2024-12-19T00:45:35.800+09:00",
      "electricEnergyDelta": 0
    }
  ]
}
```

æœ¬é …ã§ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é…ä¿¡ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## MCPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…

### æ¦‚è¦

ãƒ‡ãƒ¼ã‚¿ã®é…ä¿¡ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ã“ã®APIã‚’ãƒ©ãƒƒãƒ—ã—ã¦MCPã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚MCPã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

[MCP(Model Context Protocol)](https://modelcontextprotocol.io/introduction)ã¯ã€LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’é€£æºã™ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§AnthropicãŒä»•æ§˜åŒ–ã—ã¾ã—ãŸã€‚èº«è¿‘ãªã¨ã“ã‚ã§ã€ã‚ã‚‰ã‚†ã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã§è£œå®Œã‚„è­¦å‘Šæ©Ÿèƒ½ã‚’å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã€å½“æ™‚é©å‘½çš„ã ã£ãŸLSP(Language Server Protocol)ã‚’å‚è€ƒã«ã—ã¦ã¾ã™ã€‚

MCPã‚µãƒ¼ãƒãƒ¼ã¯åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦èµ·å‹•ã—ã€LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ `æ¨™æº–å…¥å‡ºåŠ›` ã‹ `SSE` ã‚’ä½¿ã„é€šä¿¡ã—ã¾ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ã€JSON-RPC 2.0ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€LSPã¨åŒã˜ã§ã™ã€‚

ãªãœä½œã£ãŸã®ã‹ï¼Ÿãã‚Œã¯è¤‡æ•°ã®LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(Cloud Desktopã‚„IDE(VSCode, IntelliJ))ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æä¾›ã‚’å…±é€šåŒ–ã™ã‚‹ãŸã‚ã§ã™ã€‚LSPãŒVSCode, Emacs, Vim, Neovim, IntelliJã§åŒæ§˜ã«è­¦å‘Šã‚„è£œå®Œæ©Ÿèƒ½ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã¨ä¼¼ã¦ã„ã¾ã™ã­ï¼

ä»Šå›MCPã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã¯ã€åˆ¥ã®LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨é€šä¿¡ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€å¤–éƒ¨ä¾å­˜ãŒå°‘ãªããªã‚‹ã‚ˆã†Goã§å®Ÿè£…ã—ã¾ã—ãŸ[^1]ã€‚åˆ¥ã®LLMã‚¢ãƒ—ãƒªã¨é€šä¿¡ã—ãªã„å ´åˆã€MCPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…ã‚’ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå´ã«é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

[^1]: ä»Šå›ã¯ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’è©¦ã™ç›®çš„ã‚‚ã‚ã‚‹ã®ã§ã‚ã‚‹ç¨®ç„¡ç†ã‚„ã‚Šã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å™›ã¾ã›ã¦ã„ã¾ã™ã€‚å…¬å¼ã®SDKã¯Pythonã¨TypeScriptãªã®ã§ãã¡ã‚‰ã‚’ä½¿ã£ãŸæ–¹ãŒæ¥½ã«å®Ÿè£…ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚JSã®å ´åˆã€ãƒãƒ³ãƒ‰ãƒ«ãŒå¯èƒ½ã§ã™ãŒã€Nodeè‡ªä½“ã«ä¾å­˜(ãŸã ã€Nodeã®Single executable appã‚„deno compileã ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒåŒæ¢±ã•ã‚Œã‚‹ãŸã‚å›é¿ã§ãã¾ã™)ã€‚Pythonã®å ´åˆã€Pythonãã®ã‚‚ã®ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜
ã€‚ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒŠãƒªã«ãªã‚‹Rustã‚„Zigãªã©ã‚‚è‰¯ã„é¸æŠè‚¢ã ã¨æ€ã„ã¾ã™ã€‚

### æ§‹æˆå›³

ä»¥ä¸‹ã®èµ¤æ éƒ¨åˆ†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ClaudeDesktopã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã«å…¥ã‚Œã¾ã™ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã§å‹•ã‹ã™éš›ã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã«å…¥ã‚Œã¦èµ·å‹•ã—ã¾ã™ã€‚

![architecture](https://devio2024-media.developers.io/image/upload/v1734806143/2024/12/22/slwsjijtxef3hvnadabb.png)

### å®Ÿè£…

å®Ÿè£…ã¯[ã“ã¡ã‚‰](https://github.com/shuntaka9576/smart-home/tree/daa4b240adef672f46447ceecc15a1409bbbae9c/apps/smart-home-mcp-server)ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã¯Pythonã®ãƒ—ãƒ­ã‚»ã‚¹ã¨Goã®ãƒ—ãƒ­ã‚»ã‚¹ã§æ¨™æº–å…¥å‡ºåŠ›ã‚’ä½¿ã£ã¦é€šä¿¡ã—ã¾ã™ã€‚[Model Context Protocol ã‚µãƒ¼ãƒãƒ¼ã‚’Goã§å®Ÿè£…ã™ã‚‹](https://zenn.dev/masacento/articles/3e91c61f20787b)ã‚’å‚è€ƒã«å®Ÿè£…ã®ç•¥å›³ã‚’æ›¸ãã¨ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![mcp_go_model](https://devio2024-media.developers.io/image/upload/v1734816303/2024/12/22/tnxon7tj5wccizswjkj4.png)

MCPã®`tools/list`ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã‚‰ã€ä»¥ä¸‹ã®JSONã‚’è¿”å´ã—ã€LLMãŒFunction calling(Tool Use)ãŒå‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

`tools/list`ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç®‡æ‰€
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-mcp-server/tools.json#L1-L91

`tools/list`ãŒå‘¼ã³å‡ºã—ç®‡æ‰€
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-mcp-server/worker.go#L30-L36

MCPã®[Tools](https://modelcontextprotocol.io/docs/concepts/tools)ä»•æ§˜ã‚’å‚è€ƒã«ã€ nameãŒlist-home-conditionã®å ´åˆã«ã€å‰é …ã§ä½œæˆã—ãŸAPIã‚’å‘¼ã³å‡ºã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
```
{
  name: string;          // Unique identifier for the tool
  description?: string;  // Human-readable description
  inputSchema: {         // JSON Schema for the tool's parameters
    type: "object",
    properties: { ... }  // Tool-specific parameters
  }
}
```
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-mcp-server/worker.go#L37-L71

ã‚†ãˆã«é›»åŠ›é‡ã‚„å„ç¨®ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é…ä¿¡ã§å®Ÿè£…ã—ãŸ`SMART_HOME_API_GATEWAY_DOMAIN` ã‚’ä½¿ã„ã¾ã™ã€‚

```bash:.envã‚’ä½œæˆ
cp .env.local .env
```

æ²è¼‰ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€v1éƒ¨åˆ†ã¾ã§å¿…è¦ã§ã™ã€‚
```bash:.env
SMART_HOME_API_GATEWAY_DOMAIN="https://xxxxxxxxxx.execute-api.ap-northeast-1.amazonaws.com/v1"
```

Goãƒ“ãƒ«ãƒ‰æ™‚ã¯MakefileçµŒç”±ã§`.env` ã‚’å‚ç…§ã—ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚(ã“ã‚Œã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’å…¬é–‹ã™ã‚‹éƒ½åˆä¸Šã§ã€å…¬é–‹ã—ãªã„å ´åˆã‚„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çŸ¥ã‚‰ã‚Œã¦ã‚‚å•é¡Œãªã„å ´åˆã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ã“ã‚Œã¯ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®bump upãªã©ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹æ‰‹æ³•ã§ã™ã€‚)

```bash
make build
```

ãƒ‡ãƒãƒƒã‚¯ä½œæ¥­ã¯ã€å¾Œè¿°ã™ã‚‹Pythonã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ—ãƒªã®æ¨™æº–å‡ºåŠ›ã«MCPã‚µãƒ¼ãƒãƒ¼ã®æ¨™æº–å‡ºåŠ›ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹ãŸã‚ãã¡ã‚‰ã§ç¢ºèªã—ã¾ã—ãŸã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€[ãƒ‡ãƒãƒƒã‚¯ã®æ–¹æ³•](https://modelcontextprotocol.io/docs/tools/debugging)ã‚‚ä¹—ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

å‹•ä½œç¢ºèªã¯ã€æ¬¡é …ã§Claude Desktopã‚’ä½¿ã£ã¦è¡Œã„ã¾ã™ã€‚

## Claude Desktop(with ä½œæˆã—ãŸMCPã‚µãƒ¼ãƒãƒ¼)ã§åˆ†æã—ã¦ã¿ã‚‹

### æ§‹æˆå›³

ã“ã“ã¾ã§ã§åé›†ã¨é…ä¿¡ã¨MCPã‚’å®Ÿè£…ã—ãŸã®ã§ã€Claude Desktopã§è‡ªå®…ã®é›»åŠ›é‡ãŒç°¡æ˜“ã«åˆ†æã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãè¾›ã„ã®ã§ã‚„ã£ã¦ã¿ã¾ã™ã€‚
![architecture_03](https://devio2024-media.developers.io/image/upload/v1734727149/2024/12/21/drgo3eqzjjy6dbievcke.png)

### Claude Desktopã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®è¨­å®š

APIGatewayã®APIã‚­ãƒ¼ãŒCDKã§è‡ªå‹•çš„ã«ç™ºè¡Œã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’`mcpServers.smart-home-mcp-server.env.SMART_HOME_API_KEY`ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

```bash
nvim ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

```json:~/Library/Application\ Support/Claude/claude_desktop_config.json
{
  "mcpServers": {
    "smart-home-mcp-server": {
      "command": "/Users/shuntaka/repos/github.com/shuntaka9576/smart-home/apps/smart-home-ai-agent/smart-home-mcp-server",
      "args": [],
      "env": {
        "SMART_HOME_API_KEY": "<APIGatewayã®APIã‚­ãƒ¼>" // <- ã“ã“ã«å…¥ã‚Œã¦ã­
      }
    }
  }
}
```

### åˆ†æã—ã¦ã¿ã‚‹

ä»Šæ—¥ã®é›»åŠ›é‡ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

![CleanShot 2024-12-22 at 04.04.34@2x](https://devio2024-media.developers.io/image/upload/v1734807907/2024/12/22/eepcum6vggamdjmzucsi.png)

å†…è¨³ã‚’è¦‹ã‚‹ã¨ã€`since`: `2024-12-22 00:00`ã«`until`: `2024-12-22 23:59` ã‚’æŒ‡å®šã—ã¦å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
![CleanShot 2024-12-22 at 04.06.02@2x](https://devio2024-media.developers.io/image/upload/v1734807992/2024/12/22/oh1bahp3y6bnv1f2lztq.png)

:::details å†…è¨³å…¨éƒ¨
{
  `since`: `2024-12-22 00:00`,
  `until`: `2024-12-22 23:59`
}
[{"cumulativeElectricEnergy":9196.6,"measuredInstantaneous":94,"temperature":18.1,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T00:00:36.027+09:00","updatedAt":"2024-12-22T00:00:36.027+09:00","electricEnergyDelta":40.3},{"cumulativeElectricEnergy":9196.6,"measuredInstantaneous":98,"temperature":18.1,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T00:15:36.145+09:00","updatedAt":"2024-12-22T00:15:36.145+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.6,"measuredInstantaneous":68,"temperature":17.9,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T00:30:35.874+09:00","updatedAt":"2024-12-22T00:30:35.874+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.7,"measuredInstantaneous":86,"temperature":17.8,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T00:45:35.95+09:00","updatedAt":"2024-12-22T00:45:35.95+09:00","electricEnergyDelta":0.1},{"cumulativeElectricEnergy":9196.7,"measuredInstantaneous":222,"temperature":17.8,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T01:00:36.108+09:00","updatedAt":"2024-12-22T01:00:36.108+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.7,"measuredInstantaneous":222,"temperature":17.7,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T01:15:35.916+09:00","updatedAt":"2024-12-22T01:15:35.916+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.8,"measuredInstantaneous":102,"temperature":17.7,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T01:30:35.783+09:00","updatedAt":"2024-12-22T01:30:35.783+09:00","electricEnergyDelta":0.1},{"cumulativeElectricEnergy":9196.8,"measuredInstantaneous":151,"temperature":17.7,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T01:45:35.885+09:00","updatedAt":"2024-12-22T01:45:35.885+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.9,"measuredInstantaneous":130,"temperature":17.6,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T02:00:36.169+09:00","updatedAt":"2024-12-22T02:00:36.169+09:00","electricEnergyDelta":0.1},{"cumulativeElectricEnergy":9196.9,"measuredInstantaneous":100,"temperature":17.4,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T02:15:36.241+09:00","updatedAt":"2024-12-22T02:15:36.241+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.9,"measuredInstantaneous":100,"temperature":17.3,"humidity":71,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T02:30:36.118+09:00","updatedAt":"2024-12-22T02:30:36.118+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9196.9,"measuredInstantaneous":89,"temperature":17.2,"humidity":72,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T02:45:35.934+09:00","updatedAt":"2024-12-22T02:45:35.934+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9197,"measuredInstantaneous":86,"temperature":17,"humidity":72,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T03:00:36.212+09:00","updatedAt":"2024-12-22T03:00:36.212+09:00","electricEnergyDelta":0.1},{"cumulativeElectricEnergy":9197,"measuredInstantaneous":86,"temperature":16.9,"humidity":72,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T03:15:35.829+09:00","updatedAt":"2024-12-22T03:15:35.829+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9197,"measuredInstantaneous":81,"temperature":16.8,"humidity":72,"illuminance":0,"acStatus":false,"createdAt":"2024-12-22T03:30:35.803+09:00","updatedAt":"2024-12-22T03:30:35.803+09:00","electricEnergyDelta":0},{"cumulativeElectricEnergy":9197.2,"measuredInstantaneous":180,"temperature":17.6,"humidity":73,"illuminance":40,"acStatus":true,"createdAt":"2024-12-22T03:45:36.216+09:00","updatedAt":"2024-12-22T03:45:36.216+09:00","electricEnergyDelta":0.2},{"cumulativeElectricEnergy":9197.2,"measuredInstantaneous":553,"temperature":18.7,"humidity":72,"illuminance":40,"acStatus":true,"createdAt":"2024-12-22T04:00:35.942+09:00","updatedAt":"2024-12-22T04:00:35.942+09:00","electricEnergyDelta":0}]
:::

LLMã¯å˜ç´”ãªè¨ˆç®—å‡¦ç†ãŒè‹¦æ‰‹ã§ã™ã€‚å…ˆã»ã©ã®çµæœã«ã¯é–“é•ã„ãŒã‚ã‚Šã¾ã™ã€‚ãªã®ã§å†åº¦å•ã„åˆã‚ã›ãŸã¨ã“ã‚æ­£ã—ã„å›ç­”ãŒè¿”ã£ã¦ãã¾ã—ãŸã€‚
![CleanShot 2024-12-22 at 04.08.58@2x](https://devio2024-media.developers.io/image/upload/v1734808336/2024/12/22/wfvxrf95c0t1vkzg2tgy.png)

ä»Šåº¦ã¯ç°¡å˜ãªå¯è¦–åŒ–ã‚’ã•ã›ã¦ã¿ã¾ã™ã€‚Claude Artifactsã§Reactã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã„ãã¾ã™ã€‚
![CleanShot 2024-12-22 at 04.16.37@2x](https://devio2024-media.developers.io/image/upload/v1734808649/2024/12/22/ozkc5kkfgjydntytqmau.png)

ã‚°ãƒ©ãƒ•ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚æ™‚é–“ã‚’çµã£ã¦ã„ã‚‹ã®ã¯1æ—¥åˆ†ã ã¨15åˆ†è¶³ã ã¨ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã™ãã¦ã‚³ãƒ¼ãƒ‰ç”ŸæˆãŒé–“ã«åˆã‚ãšã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã§ã™ã€‚Reactã®ã‚³ãƒ¼ãƒ‰ãªã®ã§æç”»ãŒç¶ºéº—ã§ã™ã­ã€‚
![CleanShot 2024-12-22 at 04.18.12@2x](https://devio2024-media.developers.io/image/upload/v1734808708/2024/12/22/mhonsy95wvsigdebrnr9.png)

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¿ãŸã„ãªã‚‚ã®ã‚‚ä½œã‚Œã¾ã™ã­ã€‚
![CleanShot 2024-12-19 at 08.50.03@2x](https://devio2024-media.developers.io/image/upload/v1734813121/2024/12/22/ohdsm8zi8goezsmvey5c.png)

15åº¦ä¸‹å›ã‚‹ã¨æš–æˆ¿ã‚’ã¤ã‘ã‚‹ã¨ã„ã£ãŸäººã«ã‚ˆã£ã¦ã¯æ°—ä»˜ã‘ãªã„ã‚ˆã†ãªéƒ¨åˆ†ã‚‚é¢ç™½ã„ã§ã™ã€‚
![CleanShot 2024-12-19 at 08.53.13@2x](https://devio2024-media.developers.io/image/upload/v1734813021/2024/12/22/kgaxlbh0n39u9spjclpm.png)

Claude Artifactsã®ã‚ˆã†ãªä»•çµ„ã¿ã‚’è‡ªå‰ã§ä½œã‚‹ã®ã¯å¤§å¤‰ãªã®ã§ã€MCPã‚µãƒ¼ãƒãƒ¼ã§APIã‚’ãƒ©ãƒƒãƒ—ã—ã¦Claude Desktopã§è§£æã™ã‚‹ã®ã¯æ‰‹è»½ã®ã§è‰¯ã„ã¨æ€ã„ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é‡ãŒå°‘ãªã‘ã‚Œã°ã‚ã‚‹ç¨‹åº¦ã®ã“ã¨ã¯ã§ããã†ã§ã™ã€‚

## ç”ŸæˆAI(LangGraph)ã«ã‚ˆã‚‹åˆ†æ

### æ§‹æˆå›³

![architecture_04](https://devio2024-media.developers.io/image/upload/v1734736756/2024/12/21/zpmuylxuun1z9b0dd4te.png)

LangGraphã¨ã¯LLM (Lagre Language Models; å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«)ã‚’ä½¿ç”¨ã—ãŸã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚å€‹äººçš„ã«ã¯LangSmithã¨ç°¡å˜ã«é€£æºã§ãã‚‹ã®ã§ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ‡ãƒãƒƒã‚¯ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã«ä¾¿åˆ©ã§ã™ã€‚

### IaC

FastAPIã‚’Lambda+LWAæ§‹æˆã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚15åˆ†é–“ã¯ç”Ÿæˆã«ä½¿ãˆã¾ã™ã€‚LWAã¯ä»Šå¾Œã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«å¯¾å¿œã—ãŸã„å ´åˆã‚„ECSã«è¼‰ã›æ›¿ãˆãŸã„å ´åˆã§ã‚‚èé€šãŒåŠ¹ãã¾ã™ã€‚å‰è¿°ã—ãŸGoã®MCPã‚µãƒ¼ãƒãƒ¼ã®ãƒ“ãƒ«ãƒ‰ã‚‚ã“ã®ä¸­ã§ã‚„ã‚Šã¾ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-ai-agent/Dockerfile#L1-L36

### å®Ÿè£…æ–¹é‡

LangGraphã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯2ã¤ä½œã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ãªã‚‰ä¸¡æ–¹æ¸¡ã—ã¦ã‚‚ã„ã„ã§ã™ã—ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯1ã¤ã§è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚èª¬æ˜ã‚„æ¤œè¨¼ã®ãŸã‚ä»Šå›ã¯ã“ã®æ§‹æˆã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚

* æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹
* æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç”»åƒã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹

ãƒ¢ãƒ‡ãƒ«ã¯ã“ã¡ã‚‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/95b934a59e9235f3d00e4d49735eafc5ef10fdb6/apps/smart-home-ai-agent/src/agent/common.py#L4

### æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹å ´åˆ

![forecast_by_data](https://devio2024-media.developers.io/image/upload/v1734810411/2024/12/22/dtll3ngzl5qkfv4p6z58.png)

`forecast_electric_energy_by_data_node`ã¯ã€ä»Šæœˆã®é›»æ°—æ–™é‡‘ã‚’äºˆæ¸¬ã‚’ã€æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«è¡Œã„ã¾ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚éå»ã®æ˜ç´°(10æœˆ,11æœˆ)ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æŒãŸã›ã¦ã„ã¾ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-ai-agent/src/agent/prompt/common.py#L29-L57

APIå•ã„åˆã‚ã›ã¯Function Calling(Tool Use)ã‚’çµ±ä¸€ã®IFã«ã—ãŸTool Callingã‚’ä½¿ã„ã¾ã™ã€‚

https://zenn.dev/pharmax/articles/1b351b730eef61

ã¾ãŸ`create_react_agent`ã¯ã€Toolã®åˆ©ç”¨ã™ã¹ãã‹ã‚’åˆ¤æ–­ã—ã€å®Ÿè¡Œã‚’ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã‚Œã¯æ™®é€šã«å®Ÿè£…ã™ã‚‹ã¨ãƒ„ãƒ¼ãƒ«åˆ©ç”¨ã®æœ‰ç„¡ã®åˆ¤å®šã¨ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œå‡¦ç†ã‚’è‡ªå‰ã§æ›¸ãã‚³ã‚¹ãƒˆãŒãªããªã‚Šéå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚è©³ã—ãã¯ä»¥ä¸‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
https://zenn.dev/pharmax/articles/1b351b730eef61#langgraph%EF%BC%88create_react_agent%EF%BC%89

`create_react_agent`å®Ÿè£…ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/95b934a59e9235f3d00e4d49735eafc5ef10fdb6/apps/smart-home-ai-agent/src/agent/workflows/forecast_by_data/forecast_electric_energy_by_data_node.py#L1-L34

mcp_sessionã‹ã‚‰Toolsã‚’å‘¼ã³å‡ºã—ã¦ã€`create_react_agent`ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã§ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’LLMå´ã«è¡Œã£ã¦ãã‚Œã¾ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-ai-agent/src/agent/workflows/forecast_by_data/forecast_electric_energy_by_data_node.py#L17

`adjutmet_message_for_slack_node` ã§ã¯å‡ºåŠ›ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’Slackãƒ©ã‚¤ã‚¯ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›ã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

https://github.com/shuntaka9576/smart-home/blob/aa52f767849f2bad2298730147e1c328978707f1/apps/smart-home-ai-agent/src/agent/workflows/common/adjutmet_message_for_slack_node.py#L19-L22

ã“ã¡ã‚‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚Slackå‘ã‘ã«æ•´å½¢ã•ã›ãŸã®ã§ã€emojiã‚’ä½¿ã£ã¦ã¿ã‚„ã™ã„å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

![CleanShot 2024-12-22 at 05.08.59@2x](https://devio2024-media.developers.io/image/upload/v1734811761/2024/12/22/dvsmjvraybdbv8docp9t.png)

å®Ÿéš›ã®ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒã—ã¦ã¿ã¾ã™ãŒã€ã‚„ã¯ã‚Šãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã¯ä¸€èˆ¬çš„ãªå†…å®¹ã«çµ‚å§‹ã—ã¦ãŠã‚Šã€ã¾ã å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¦‹ç›´ã—ãŒå¿…è¦ã ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã¦ãã‚‹ã¨ã‚ˆã‚Šæ–™é‡‘è©¦ç®—ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒç´å¾—ã—ã‚„ã™ã„ã‚‚ã®ã«ãªã‚Šãã†ã§ã™ã€‚
![tmphuxyqmdh](https://devio2024-media.developers.io/image/upload/v1734812742/2024/12/22/qinit2ncaahcb1f7tfxm.png)

LangSmithã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™ã€‚

![CleanShot 2024-12-22 at 05.11.33@2x](https://devio2024-media.developers.io/image/upload/v1734811929/2024/12/22/z7imtoa5mser1g7mpcvd.png)

è©³ã—ãã¿ã‚‹ã¨ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãŒTool Callingã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚
![CleanShot 2024-12-22 at 05.13.24@2x](https://devio2024-media.developers.io/image/upload/v1734812066/2024/12/22/hsauj5chy3ith1rsdura.png)

### æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç”»åƒã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«ã™ã‚‹å ´åˆ

å‰é …ã®ã‚„ã‚Šæ–¹ã§ã™ã¨ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚µã‚¤ã‚ºã®å•é¡ŒãŒã‚ã‚‹ã®ã§ã€ç”»åƒã‚’ä½¿ã„ã¾ã™ã€‚

![forecast_by_png](https://devio2024-media.developers.io/image/upload/v1734810416/2024/12/22/czlfybhl6pha2akikl2p.png)

| Node Name                             | Explanation                                                                                   |
|---------------------------------------|-----------------------------------------------------------------------------------------------|
| `get_sensor_duration_node`            | æ˜ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã‚°ãƒ©ãƒ•ä½œã‚‹æœŸé–“ã‚’LLMã«ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã†                           |
| `gen_sensor_data_graph_node`          | å‰ãƒãƒ¼ãƒ‰ã®æœŸé–“ã‚’å…ƒã«ã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆ(LLMã¯ä½¿ã„ã¾ã›ã‚“)                   |
| `forecast_electric_energy_by_png_node`| å‰ãƒãƒ¼ãƒ‰ã®ç”»åƒã‚’å…ƒã«LLMã«äºˆæ¸¬         |
| `adjustmet_message_for_slack_node`    | å‰é …ã©ã®ã‚ˆã†ã«Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«LLMã§æ•´å½¢       |

Slackã¸ãƒ¬ãƒãƒ¼ãƒˆã¨ç”Ÿæˆã—ãŸç”»åƒã®ä¸¡æ–¹ã‚’é€ã£ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚
https://github.com/shuntaka9576/smart-home/blob/737d6f6a8f25d22f6665ffea6b8ea07bfc08dc9f/apps/smart-home-ai-agent/src/application/use_case/create_electric_energy_report_use_case.py#L21-L22

çµæœã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ãƒ¬ãƒãƒ¼ãƒˆ
![CleanShot 2024-12-22 at 05.26.33@2x](https://devio2024-media.developers.io/image/upload/v1734812814/2024/12/22/m8wqs2f0el8jaikjrxhg.png)

ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®ç”»åƒ(æ‹¡å¤§)
![tmphuxyqmdh](https://devio2024-media.developers.io/image/upload/v1734812742/2024/12/22/qinit2ncaahcb1f7tfxm.png)

ã“ã¡ã‚‰ã‚‚ã‚ã‚‹ç¨‹åº¦å‚¾å‘ã‚’æ´ã‚“ã§ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

LangSmithã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™ã€‚äºˆæ¸¬ã™ã‚‹éƒ¨åˆ†ã®LLMã®å‡¦ç†ãŒä¸€ç•ªæ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã­ï¼

![CleanShot 2024-12-22 at 05.37.20@2x](https://devio2024-media.developers.io/image/upload/v1734813506/2024/12/22/c5anfew97cwr9cllextj.png)

## ã•ã„ã”ã«

ä»Šå›ã¯ç”ŸæˆAIã‚’ä½¿ã£ã¦çŸ­ã„æœŸé–“ã®åˆ†æã‚’ã—ã¾ã—ãŸã€‚ã§ã‚ã‚Œã°ã‚ã‚‹ç¨‹åº¦ä¿¡é ¼æ€§ã®ã‚ã‚‹å‚¾å‘ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã®ã§åˆ©ç”¨ä¾¡å€¤ãŒé«˜ãã†ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

ç”ŸæˆAIã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚‚ã•ã¾ã–ã¾ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã€ç‰¹ã«o11yå‘¨ã‚Šã®langSmithã¯ç”ŸæˆAIã‚¢ãƒ—ãƒªã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§å¿…è¦ä¸å¯æ¬ ã§ã™ã€‚è‡ªç„¶è¨€èªã‚„ãƒã‚¤ãƒŠãƒªã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãŒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¸­ã§è¤‡é›‘ã«é·ç§»ã™ã‚‹ã®ã§ã€åŒã˜ã“ã¨ã‚’ãƒ­ã‚®ãƒ³ã‚°ã§ã‚„ã‚‹ã«ã¯éå¸¸ã«éª¨ãŒæŠ˜ã‚Œã¾ã™ã€‚ã“ã‚ŒãŒãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ¦ãƒ¼ã‚¹ã«ãªã‚‹ã¨ä¾¡æ ¼é¢ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢ã§langfuseã«ãªã‚Šã‚„ã™ã„æ°—ãŒã—ã¾ã™ãŒã€ã‚„ã¯ã‚Šæœ¬å®¶ã¯ã‚ˆãå‡ºæ¥ã¦ã„ã¾ã™ã€‚

ã¾ãŸä»Šå¾ŒClaude Desktopã®ã‚ˆã†ãªLLMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé«˜åº¦åŒ–ã—ã¦ãã‚‹ã¨MCPã¯é‡è¦ã ãªã¨æ€ã„ã¾ã—ãŸã€‚é€£æºã•ãˆã—ã¦ã—ã¾ãˆã°å€‹äººçš„ãªãƒ‡ãƒ¼ã‚¿ã‚‚ã‚µãƒ–ã‚¹ã‚¯æ–™é‡‘å†…ã§è‡ªç”±ã«è§£æãŒã§ãã‚‹ãŸã‚ã€ä¾¿åˆ©ã§ã™ã€‚ä»–ã®ãƒ™ãƒ³ãƒ€ãƒ¼ã‚‚è¿½å¾“ã™ã‚‹ã¨ã„ã„ã§ã™ã­ã€‚

ä»Šå¾Œã‚„ã£ã¦ã¿ãŸã„ã“ã¨ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

* ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®æ¤œè¨¼(ä»Šå›ä¸€ç•ªã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã¨ã“ã‚ã§ã—ãŸãŒã€åŠ›å°½ãã¾ã—ãŸã€ã€)
* MCPã‚µãƒ¼ãƒãƒ¼ã®æ©Ÿèƒ½ã¨ã—ã¦ä»Šå›ã¯Toolsã—ã‹ä½¿ã£ã¦ãªã„ã®ã§ã€Resourceã‚„Promptsã€Samplingã‚‚å®Ÿè£…ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼
* Pandas Dataframe Agentã‚’ä½¿ã£ãŸè‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹è§£æ(ä»Šå›ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„å ´åˆã§ã‚‚æ¯”è¼ƒçš„ãƒˆãƒ¼ã‚¯ãƒ³æ•°å°‘ãªã‚ã§æŸ”è»Ÿã«è§£æå¯èƒ½)

å®Ÿéš›èª¬æ˜ã—ãã‚Œã¦ã„ãªã„éƒ¨åˆ†ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚ãŸã å…¬é–‹ã—ã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰ã¯ãªã„ã®ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã‚’è¦‹ã‚Œã°åŒã˜ã‚‚ã®ã¯ä½œã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚

ä½•ã‹ã‚ã‚Œã°ã€issueã«ãŠé¡˜ã„ã—ã¾ã™ï¼

## å‚è€ƒè³‡æ–™

è„šæ³¨ã‚‚åˆã‚ã›ã¦æ§˜ã€…ãªè¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

* [AWS IoT ã¨ ç”Ÿæˆ AI ã‚’ä½¿ã£ã¦è‡ªå®…ã®æ¶ˆè²»é›»åŠ›ã‚’æ¸¬å®šãƒ»äºˆæ¸¬ã—ã¦ã¿ã‚ˆã†](https://aws.amazon.com/jp/builders-flash/202411/forecast-house-power-consumption/)
* [Nature Remo E liteã§ã€ãŠã†ã¡ã®æ¶ˆè²»é›»åŠ›ã‚’è¦‹ãˆã‚‹åŒ–ã—ã¦ã¿ãŸ](https://qiita.com/c60evaporator/items/4040040095aa58dcb5b1)
* [Slackã«APIçµŒç”±ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹(Python)](https://qiita.com/munaita_/items/97105648165f6a60442c)
* [Slackãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã§ãã‚‹SlackAppã‚’ä½œæˆã™ã‚‹](https://dev.classmethod.jp/articles/post-messages-to-slack-channel/)
